@using ShoesShop.Domain.Modules.Orders.Enums
@using ShoesShop.Web.Modules.Order.Dtos
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject Microsoft.Extensions.Options.IOptions<CloudinarySettings> CloudinaryConfig
@model List<OrderModalDto>

@{
    ViewData["Title"] = "My Orders";
    Layout = "~/Modules/Shares/Views/_Layout.cshtml";
}

<link rel="stylesheet" href="~/assets/product/css/bootstrap.min.css">
<link rel="icon" href="~/images/favicon.png">
<link rel="stylesheet" href="~/assets/product/css/style.css">

<style>
.order-container { max-width: 1200px; margin: 100px auto; padding: 0 20px; }
.order-title { font-size: 32px; font-weight: 700; text-align: center; color: #fff; margin-bottom: 50px; }
.order-card { background: #000; border-radius: 20px; padding: 25px 30px; margin-bottom: 35px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); transition: 0.3s; border: 1px solid #222; }
.order-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(28, 28, 28, 0.7); }
.order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.order-header h3 { color: #fff; font-size: 20px; margin: 0; }
.order-date { font-size: 14px; color: #aaa; }
.order-status { display: flex; align-items: center; gap: 10px; padding: 8px 16px; border-radius: 30px; font-weight: 600; text-transform: capitalize; }
.status-completed { background: #16a34a33; color: #16a34a; }
.status-pending { background: #facc1533; color: #ffb700; }
.status-cancelled { background: #f8717133; color: #b91c1c; }
.order-body p { color: #ddd; font-size: 15px; margin: 8px 0; }
.order-items { margin-top: 15px; background: #1a1a1a; border-radius: 15px; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
.order-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #333; }
.order-item:last-child { border-bottom: none; }
.order-item-left { display: flex; align-items: center; gap: 15px; }
.order-item-left img { width: 65px; height: 65px; object-fit: cover; border-radius: 12px; border: 1px solid #222; }
.order-item-left .name { color: #fff; font-weight: 500; font-size: 15px; }
.order-item-left .qty { color: #aaa; font-size: 13px; margin-top: 3px; }
.order-item-right { color: #facc15; font-weight: 600; font-size: 14px; }
.order-footer { display: flex; justify-content: flex-end; margin-top: 25px; }
.btn-detail { background: linear-gradient(135deg, #0071e3, #0058a8); color: #fff; padding: 10px 22px; border-radius: 12px; font-weight: 600; transition: 0.3s; border: none; cursor: pointer; }
.btn-detail:hover { transform: translateY(-2px); background: linear-gradient(135deg, #0058a8, #003f75); }
.empty-order { display: flex; flex-direction: column; align-items: center; margin-top: 60px; color: #888; text-align: center; }
.empty-order img { width: 180px; opacity: 0.7; margin-bottom: 15px; }

media(max-width:768px){.order-header { flex-direction: column; align-items: flex-start; gap: 10px; } .order-item { flex-direction: column; align-items: flex-start; gap: 8px; } .order-footer { justify-content: center; }
}
</style>

<section class="breadcrumb breadcrumb_bg">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="breadcrumb_iner">
                    <div class="breadcrumb_iner_item">
                        <h2>Your Orders</h2>
                        <p>Home <span>-</span>Orders</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="order-container">
    <h2 class="order-title"></h2>

    @if (Model == null || !Model.Any())
    {
        <div class="empty-order">
            <img src="~/assets/images/empty-cart.png" alt="No Orders"/>
            <p>You haven't placed any orders yet.</p>
        </div>
    }
    else
    {
        foreach(var order in Model)
        {
            var statusText = order.Status switch
            {
                OrderStatus.Completed => "Completed",
                OrderStatus.Pending => "Processing",
                OrderStatus.Cancelled => "Cancelled",
                _ => "Unknown"
            };

            var statusClass = order.Status switch
            {
                OrderStatus.Completed => "status-completed",
                OrderStatus.Pending => "status-pending",
                OrderStatus.Cancelled => "status-cancelled",
                _ => "status-pending"
            };

            <div class="order-card">
                <div class="order-header">
                    <div>
                        <h3>Order #@order.Id</h3>
                        <p class="order-date">Placed on @order.OrderDate.ToString("MMM dd, yyyy")</p>
                    </div>
                    <span class="order-status @statusClass">@statusText</span>
                </div>

                <div class="order-body">
                    <p><strong>Total:</strong> $@order.TotalAmount.ToString("N2")</p>
                    <p><strong>Payment:</strong> @order.PaymentMethod.ToString() (@order.PaymentStatus.ToString())</p>

                    <div class="order-items">
                        @foreach(var item in order.OrderDetails)
                        {
                            var baseUrl = CloudinaryConfig.Value.BaseUrl.EndsWith("/") ? CloudinaryConfig.Value.BaseUrl : $"{CloudinaryConfig.Value.BaseUrl}/";
                            var imgUrl = !string.IsNullOrEmpty(item.ProductImage) 
                                         ? (item.ProductImage.StartsWith("http") ? item.ProductImage : $"{baseUrl}{item.ProductImage}") 
                                         : "/images/default.png";

                            <div class="order-item">
                                <div class="order-item-left">
                                    <img src="@imgUrl" alt="@item.ProductName"/>
                                    <div>
                                        <div class="name">@item.ProductName</div>
                                        <div class="qty">Qty: @item.Quantity</div>
                                    </div>
                                </div>
                                <div class="order-item-right">$@item.UnitPrice.ToString("N2")</div>
                            </div>
                        }
                    </div>
                </div>

                <div class="order-footer">
                    <form asp-controller="Order" asp-action="Success" method="get">
                        <input type="hidden" name="orderId" value="@order.Id" />
                        <button class="btn-detail" type="submit">View Details</button>
                    </form>
                </div>
            </div>
        }
    }
</div>
